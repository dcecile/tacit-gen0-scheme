#!/usr/bin/env perl
use strict;
use warnings;

use File::Spec::Functions qw(splitdir rel2abs catdir catfile);
use List::Util qw(first);

my @dirs = splitdir (rel2abs '.');
my $end = first { $dirs[$_] eq 'scheme' } (reverse 0..$#dirs);
@dirs = @dirs[0 .. $end];
my $root = catdir @dirs;

exec 'racket',
  '-e', '(define (main) (void))',
  '-f', (catfile $root, qw(src utils platform__racket.scm)),
  '-f', (catfile $root, qw(src utils use__racket.scm)),
  '-f', (catfile $root, qw(src utils use__define-syntax.scm)),
  '-f', (catfile $root, qw(src utils use.scm)),
  '-f', @ARGV,
  '-e', '(begin (main) (void))';
